[Back to table of contents](API.md)

# Log Entries
The log entries domain deals with log entries in a user's log book.

## A Note on Units
The back-end application works exclusively in **metric**. All of the APIs below that accept or return data
related to temperature, depth/distance, pressure, or weight will use/take values in degrees celcius,
meters, bars, and kilograms, respectively. Though user profiles support the `temperatureUnit`,
`distanceUnit`, `pressureUnit` and `weightUnit` properties, these units are not checked when
saving/retrieving log entry information. It is up to the front-end application to consume these properties
and make the appropriate conversions... Or just stick with **metric** ;)

## Classes
### LogEntry Object
Describes a single log entry from a user's log book.

```json
{
	"entryId": "String: A globally-unique ID that identifies the log entry. (Generated upon creation.)",
	"diveNumber": "Number: Integer indicating which career dive this is",
	"entryTime": "REQUIRED String: A Date and Time in ISO 8601 format",
	"location": "REQUIRED String: Up to 200 characters",
	"site": "REQUIRED String: Up to 200 characters",
	"gps": {
		"latitude": "REQUIRED Number: Between -90.0 and 90.0",
		"longitude": "REQUIRED Number: Between -180.0 and 180.0"
	},
	"bottomTime": "REQUIRED Number: Bottom time minutes (must be positive)",
	"totalTime": "Number: Total dive time, including ascent/stops (must be positive and >= 'bottomTime')",
	"surfaceInterval": "Number: Duration in minutes of the surface interval taken before this dive",
	"averageDepth": "Number: Average depth in meters",
	"maxDepth": "REQUIRED Number: Maximum depth in meters (must be >= 'averageDepth')",
	"air": {
		"in": "Number: The amount of air (in bar) in the cylinder(s) when entering the water.",
		"out": "Number: The amount of air (in bar) in the cylinder(s) when exiting the water.",
		"doubles": "Boolean: True if the dive was done with doubles (or sidemount.)",
		"volume": "Number: Volume of the tank(s) in litres or cubic feet.",
		"volumeUnit": "String: Unit used to measure the volume of the cylinder. (One of 'L' or 'cf'.)",
		"material": "String: The material the tank(s) are made of. (One of 'aluminum' or 'steel'.)",
		"oxygen": "Number: The % oxygen content of the breathing gas. (1-100%.)",
		"helium": "Number: The % helium content of the breathing gas. (0-95%.)"
	},
	"decoStops": [
		{
			"depth": "REQUIRED Number: The depth (in meters) that the stop was made at. (Must be positive.",
			"duration": "REQUIRED Number: The duration (in minutes) of the stop. (Must be positive.)"
		},
		{
			"depth": "...",
			"duration": "..."
		}
	],
	"temperature": {
		"surface": "Number: The temperature (degrees Celcius) at the surface. Between -2 and 50 degrees.",
		"water": "Number: The temperature (degrees Celcius) below the surface. Between -2 and 50 degrees.",
		"thermoclines": [
			{
				"temperature": "REQUIRED Number: The temperature below the thermocline (degrees Celcius between -2 and 50.)",
				"depth": "Number: The depth (in meters) where the thermocline was. (Must be positive.)"
			}
		]
	},
	"weight": {
		"amount": "Number: Amount of weight worn in kilograms. (Must be zero or more.)",
		"correctness": "String: Indication of how good the weight was. (One of 'good', 'too much' or 'too little')",
		"trim": "String: Indication of how good the trim was. (One of 'good', 'feet down' or 'feet up'.)"
	},
	"tags": [],
	"comments": "String: Free-form comments about the dive. 1000 characters or less."
}
```
**Notes:**

`entryId` is generated by the database when log entries are first saved. It should **not** be included in
`POST` or `PUT` request bodies. For the `PUT` method, it will be included as a route parameter.

The `gps`, `air`, `decoStops`, `temperature`, `tags` and `weight` nested objects are all considered
optional.

The value of `air.out` cannot exceed that of `air.in`. Attempting this will cause a validation error.

The `air.volume` and `air.volumeUnit` values must be supplied together. Both can be omitted but if one is
missing and the other is present, it will cause a validation error.

The `decoStops` array can contain from 0 to 15 depth/duration tuples representing each of the
decompression stops. The stops should be ordered chronologically (i.e. deepest to shallowest.)

The `temperature.thermoclines` array can contain from 0 to 4 temperature/depth tuples representing each
of the thermoclines encountered on the dive. The thermoclines should be in ascending order by depth
(shallowest to deepest.)

The `tags` array can contain up to 50 alphanumeric string tags (25 characters or less.) These are used for
indexing and searching similar dives.

### LogEntrySummary Object
An abbreviated version of a [LogEntry](#logentry-object) object. It contains fewer properties and is
suitable to be returned in queries for many log entries.

```json
{
	"entryId": "String: A globally-unique ID that identifies the log entry.",
	"entryTime": "String: A Date and Time in ISO 8601 format",
	"location": "String: Up to 200 characters",
	"site": "String: Up to 200 characters",
	"bottomTime": "Number: Bottom time minutes",
	"maxDepth": "Number: Maximum depth in meters"
}
```

## Routes
### GET /users/:userName/logs
Queries a user's log book for log entries.

#### Route Parameters
* **userName** - Name of the user whose log book the entries will be queried from.

#### Query Parameters
* **count** - Maximum number of records to return in the query. Can be any number between 1 and 1000.
* **sortBy** - The field on which the returned entries should be sorted. Allowed values are **entryTime**,
**bottomTime**, and **maxDepth**. The default is **entryTime**.
* **sortOrder** - The order in which sorted entries should be returned. Allowed values are **asc**
(ascending order), and **desc** (descending order.) The default value is **desc**.
* **lastSeen** - For searches where some results have already been shown, the **lastSeen** value should be
set to the entryTime, maxDepth, or bottomTime (depending on the value of the **sortBy** parameter) of the
last entry returned in the previous query. This tells the API that the search should resume at or beyond
that value.
* **seenIds** - For searches where some results have already been show, the **seenIds** value should be
set to an array of entryIds that should be excluded from the results. Example: A search was made for entries
ordered by bottomTime in descending order. The last entry returned had a bottomTime of 38 minutes. To
continue getting more results **lastSeen** should be set to 38, and **seenIds** should be a comma-separated
list of all entry Ids that have already been returned where bottomTime is 38 minutes (so that they are not
repeated in the next set of results.)

**NOTE:** The **sortBy** and **sortOrder** parameters are a pair. If one is included in the query string,
then the other is also required.

#### Responses
HTTP Status Code | Details
----- | -----
**200 OK** | The call succeeded and the response body will contain an array of [LogEntrySummary](#logentrysummary-object) objects.
**400 Bad Request** | The request was rejected because one or more of the query string parameters were invalid.
**403 Forbidden** | The request was rejected because the current user does not have permission to view the log book for the user specified in the **userName** route parameter.
**404 Not Found** | The request failed because the user specified in the **userName** route parameter does not exist.
**500 Server Error** | An internal server error occurred. Log information will be provided in the [Error](General.md#error-object) object for troubleshooting.

### POST /users/:userName/logs
Creates new log entries. The call will allow the creation of up to 100 entries at a time.

#### Route Parameters
* **userName** - Name of the user whose log book the entries will be added to.

#### Message Body
An array of [LogEntry](#logentry-object) objects. *Note that the `entryId` property must not be set!*

#### Responses
HTTP Status Code | Details
----- | -----
**201 Created** | The call succeeded and the new log entries have been saved. The response body will contain the same array of [LogEntry](#logentry-object) objects that were provided in the request except that the `entryId` properties will be filled in.
**400 Bad Request** | The request was denied because there was a problem with the request body. One or more entries may have failed validation, the request may have been malformed, or perhaps, more than 100 log entries were provided in the request. The details of the [Error](General.md#error-object) object returned will contain specific information.
**401 Unauthorized** | The request was denied because the current user is not authenticated.
**403 Forbidden** | The request was denied because the currently logged-in user does not have sufficient permission to edit the log entries in the specified user's log book.
**404 Not Found** | The user name provided in the `:userName` parameter could not be found.
**500 Server Error** | An internal server error occurred. Log information will be provided in the [Error](General.md#error-object) object for troubleshooting.

### PUT /users/:userName/logs
Updates and replaces existing log entries. The call will allow up to 100 entries at a time to be updated.

#### Route Parameters
* **userName** - Name of the user whose log book the entries belong to.

#### Message Body
An array of [LogEntry](#logentry-object) objects with the desired modifications made to them.

#### Responses
HTTP Status Code | Details
----- | -----
**200 OK** | The call succeeded and the log entries have been saved. The response body will contain the same array of [LogEntry](#logentry-object) objects that were provided in the request.
**400 Bad Request** | The request was denied because there was a problem with the request body. One or more entries may have failed validation, the request may have been malformed, or perhaps, more than 100 log entries were provided in the request. The details of the [Error](General.md#error-object) object returned will contain specific information.
**401 Unauthorized** | The request was denied because the request was not authenticated.
**403 Forbidden** | The request was denied because the currently logged-in user does not have sufficient permission to edit the log entries in the specified user's log book.
**404 Not Found** | The user name provided in the `:userName` parameter could not be found.
**500 Server Error** | An internal server error occurred. Log information will be provided in the [Error](General.md#error-object) object for troubleshooting.

### DELETE /users/:userName/logs
Deletes the specified log entries from the user's log book.

#### Route Parameters
* **userName** - Name of the user whose log book the entries belong to.

#### Message Body
An array of `LogEntry` IDs (as seen in the `entryId` properties of the log entries.) E.g.

```json
[
	"e53e3c02feed97b42557bf4c",
	"336ad3167c14419d6328de6e",
	"5e9d1788f382ac12be0c0333"
]
```

#### Responses
HTTP Status Code | Details
----- | -----
**204 No Content** | The call succeeded and the log entries have been deleted. The response body will be empty as the HTTP code suggests.
**400 Bad Request** | The request was denied because there was a problem with the request body. The array may have been malformed. The details of the [Error](General.md#error-object) object returned will contain specific information.
**401 Unauthorized** | The request was denied because the request was not authenticated.
**403 Forbidden** | The request was denied because the currently logged-in user does not have sufficient permission to edit the log entries in the specified user's log book.
**404 Not Found** | The user name provided in the `:userName` parameter could not be found.
**500 Server Error** | An internal server error occurred. Log information will be provided in the [Error](General.md#error-object) object for troubleshooting.

### GET /users/:userName/logs/:logId
Retrieves a single log entry from a user's log book.

#### Route Parameters
* **userName** - Name of the user whose log book the entries will be added to.
* **logId** - The ID of the log entry (`entryId`) to return.

#### Responses
HTTP Status Code | Details
----- | -----
**200 OK** | The call succeeded and response body will contain the requested [LogEntry](#logentry-object) object.
**401 Unauthorized** | The request was denied because the current user is not authenticated and the log book is not marked as public.
**403 Forbidden** | The request was denied because the currently logged-in user does not have sufficient permission to view the log entries in the specified user's log book.
**404 Not Found** | The user name provided in the `:userName` parameter could not be found or no log entry exists with the specified `:logId`.
**500 Server Error** | An internal server error occurred. Log information will be provided in the [Error](General.md#error-object) object for troubleshooting.

### PUT /users/:userName/logs/:logId
Updates and replaces specified log entry.

#### Route Parameters
* **userName** - Name of the user whose log book the entries belong to.
* **logId** - The ID of the log entry (`entryId`) that needs to be updated.

#### Message Body
A [LogEntry](#logentry-object) object with the desired modifications made to them.

#### Responses
HTTP Status Code | Details
----- | -----
**200 OK** | The call succeeded and the log entry has been saved. The response body will contain the same [LogEntry](#logentry-object) object that were provided in the request.
**400 Bad Request** | The request was denied because there was a problem with the request body. The entry may have failed validation, or the request may have been malformed. The details of the [Error](General.md#error-object) object returned will contain specific information.
**401 Unauthorized** | The request was denied because the current user is not authenticated.
**403 Forbidden** | The request was denied because the currently logged-in user does not have sufficient permission to edit the log entry in the specified user's log book.
**404 Not Found** | The user name provided in the `:userName` parameter could not be found or the specified log entry does not exist.
**500 Server Error** | An internal server error occurred. Log information will be provided in the [Error](General.md#error-object) object for troubleshooting.

### DELETE /users/:userName/logs/:logId
Deletes the specified log entry.

#### Route Parameters
* **userName** - Name of the user whose log book the entry belongs to.
* **logId** - The ID of the log entry (`entryId`) that needs to be deleted.

#### Responses
HTTP Status Code | Details
----- | -----
**204 No Content** | The call succeeded and the log entry has been deleted. The response body will be empty.
**401 Unauthorized** | The request was denied because the current user not authenticated.
**403 Forbidden** | The request was denied because the currently logged-in user does not have sufficient permission to edit or delete the log entry in the specified user's log book.
**404 Not Found** | The user name provided in the `:userName` parameter could not be found or the specified log entry does not exist.
**500 Server Error** | An internal server error occurred. Log information will be provided in the [Error](General.md#error-object) object for troubleshooting.
